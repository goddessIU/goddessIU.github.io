import{u as V,c as et,d as T,e as U,f as X}from"./index.e5d8f9d2.js";import{_ as ot}from"./lodash.2827fe9f.js";import{_ as J,b as ct,f as i,g as _,e as c,K as Y,A as W,h as s,c as nt,v as rt,F as x,z as A,y as h,p as P,i as Q,r as $,I as G,j as at,n as tt,o as it,w as _t,B as Z,T as lt,l as dt,L as ut,M as ht}from"./vendor.6b481748.js";const K=V(),H=({secondIndex:p,firstIndex:f,operator:r,spec:k})=>{const y=K.storeInfoData[f],u=y.restaurant_id,l=y.id,g=y.foods[p],I=g.specfoods[0],m=g.item_id,S=g.specfoods;let v,d="",a;k===null?(v=S[0].sku_id,a=S[0].stock):(v=S[k].sku_id,a=S[k].stock,d=S[k].specs[0].value);let o=et("shopCart",u);o||(o={}),o[l]||(o[l]={}),o[l][m]||(o[l][m]={}),o[l][m][v]||(o[l][m][v]={quantity:0,specs:d,sku_id:v,stock:a,restaurantId:u,foodId:m,classId:l,secondIndex:p,firstIndex:f,specIndex:k});const t=o[l][m][v];r==="+"?(t.quantity++,t.quantity>=100&&I.stock&&(t.quantity=100)):r==="-"&&(t.quantity--,t.quantity<=0&&(t.quantity=0)),t.attrs=g.attrs||[],t.extra=g.extra||{},t.name=I.name,t.packing_fee=I.packing_fee,t.price=I.price;const e=T("itemsObj");e[u]||(e[u]={}),e[u][m]||(e[u][m]={}),e[u][m][v]=t,U("itemsObj",u,e[u]),U("shopCart",u,o),K.storageShop=T("shopCart"),K.itemsObj=T("itemsObj")};const E=p=>(P("data-v-2a8c8a58"),p=p(),Q(),p),pt={key:0,class:"shopCart__content"},vt=E(()=>s("h1",null,"\u8D2D\u7269\u8F66",-1)),ft=E(()=>s("svg",{class:"icon","aria-hidden":"true"},[s("use",{"xlink:href":"#icon-ashbin"})],-1)),mt=at("\u6E05\u7A7A "),St=[ft,mt],gt={class:"shopCart__content__bar"},Ct={key:0,class:"shopCart__content__middleBar"},kt={class:"shopCart__bar__specName"},It={class:"shopCart__bar__name"},yt={class:"shopCart__bar__spec"},$t={class:"shopCart__bar__price"},bt={class:"right__content__controlNum"},wt=["onClick"],xt=E(()=>s("svg",{class:"icon","aria-hidden":"true"},[s("use",{"xlink:href":"#icon-Subtract"})],-1)),Ft=[xt],Nt={class:"right__controlNum__showNum"},Dt=["onClick"],At=E(()=>s("svg",{class:"icon","aria-hidden":"true"},[s("use",{"xlink:href":"#icon-add"})],-1)),Ot=[At],jt={class:"shopCart__detail__price"},qt={class:"shopCart__detail__delivery"},Rt={class:"shopCart__detail__icon"},Tt=E(()=>s("svg",{class:"icon","aria-hidden":"true"},[s("use",{"xlink:href":"#icon-shop-cart-1"})],-1)),Et={class:"shopCart__detail__number"},Lt={key:2,class:"shopCart__unsettlement"},Bt={setup(p){const f=ct(),r=V(),k=()=>{f.push({name:"order"})},y=()=>{let a=$(!1);return{isShowCart:a,changeshowCart:()=>{console.log("22222222222222222"),a.value=!a.value},closeShowCart:e=>{e.target.className==="mask"&&(a.value=!a.value)}}},{isShowCart:u,changeshowCart:l,closeShowCart:b}=y(),g=({firstIndex:a,secondIndex:o,operator:t,spec:e})=>{H({secondIndex:o,firstIndex:a,operator:t,spec:e}),r.itemsObj=T("itemsObj")},I=()=>{X("itemsObj",r.currentShopId),r.itemsObj[r.currentShopId]={},X("shopCart",r.currentShopId),r.storageShop[r.currentShopId]={},l()},m=()=>{const a=G(()=>{let e=0;for(let n in r.itemsObj[r.currentShopId])for(let C in r.itemsObj[r.currentShopId][n])e+=parseInt(r.itemsObj[r.currentShopId][n][C].quantity);return u.value=!1,e||0}),o=G(()=>{let e=0;for(let n in r.itemsObj[r.currentShopId])for(let C in r.itemsObj[r.currentShopId][n])e+=parseInt(r.itemsObj[r.currentShopId][n][C].quantity*parseInt(r.itemsObj[r.currentShopId][n][C].price));return e||0}),t=G(()=>parseInt(r.currentStoreData.float_minimum_order_amount)-o.value);return{sum:o,sumNum:a,canDelivery:t}},{sum:S,sumNum:v,canDelivery:d}=m();return(a,o)=>(i(),_(x,null,[c(u)&&c(v)?(i(),_("div",{key:0,class:"mask",onClick:o[0]||(o[0]=Y((...t)=>c(b)&&c(b)(...t),["prevent"]))})):W("",!0),s("div",{class:"shopCart",onClick:o[2]||(o[2]=Y((...t)=>c(b)&&c(b)(...t),["prevent"]))},[c(v)?nt((i(),_("div",pt,[s("div",{class:"shopCart__content__head"},[vt,s("div",{onClick:I},St)]),(i(!0),_(x,null,A(c(r).itemsObj[c(r).currentShopId],(t,e)=>(i(),_("div",gt,[(i(!0),_(x,null,A(t,(n,C)=>(i(),_("div",null,[n.quantity?(i(),_("div",Ct,[s("div",kt,[s("div",It,h(n.name),1),s("div",yt,h(n.specs),1)]),s("div",$t,"\uFFE5"+h(n.price),1),s("div",bt,[s("div",{class:"right__controlNum__subtract",onClick:w=>g({secondIndex:n.secondIndex,firstIndex:n.firstIndex,operator:"-",spec:n.specIndex})},Ft,8,wt),s("div",Nt,h(n.quantity),1),s("div",{class:"right__controlNum__add",onClick:w=>g({secondIndex:n.secondIndex,firstIndex:n.firstIndex,operator:"+",spec:n.specIndex})},Ot,8,Dt)])])):W("",!0)]))),256))]))),256))],512)),[[rt,c(u)]]):W("",!0),s("div",{class:"shopCart__detail",onClick:o[1]||(o[1]=(...t)=>c(l)&&c(l)(...t))},[s("div",jt,"\uFFE5"+h(c(S)),1),s("div",qt,"\u914D\u9001\u8D39\uFFE5"+h(c(r).currentStoreData.float_delivery_fee),1),s("div",Rt,[Tt,s("span",Et,h(c(v)),1)])]),c(d)<=0?(i(),_("button",{key:1,class:"shopCart__settlement",onClick:k},"\u53BB\u7ED3\u7B97")):(i(),_("button",Lt,"\u8FD8\u5DEE"+h(c(d)),1))])],64))}};var Wt=J(Bt,[["__scopeId","data-v-2a8c8a58"]]);const Ht=p=>(P("data-v-3aca8b1e"),p=p(),Q(),p),Vt={class:"mask"},Mt={class:"SpecFoods"},zt={class:"SpecFoods__title"},Gt={class:"SpecFoods__title__content"},Kt={class:"SpecFoods__content"},Jt=Ht(()=>s("div",{class:"SpecFoods__content__name"},"\u89C4\u683C",-1)),Pt=["onClick"],Qt={class:"SpecFoods__addCart"},Ut={class:"SpecFoods__addCart__price"},Xt={emits:["closeSpec"],setup(p,{emit:f}){const r=V(),k=()=>{const o=r.specObj.classId,t=r.specObj.foodId,e=r.storeInfoData[o].foods[t].specfoods;return{classId:o,foodId:t,specArrs:e}},{classId:y,foodId:u,specArrs:l}=k(),b=()=>{let o=$(l[0].price);return{spec:$(l[0].value),price:o}},{spec:g,price:I}=b(),m=()=>{let o=$(0);return{isChoosed:o,chooseSpec:(e,n)=>{o.value=e,I.value=n.price,g.value=l[e].specs[0].value}}},{isChoosed:S,chooseSpec:v}=m(),d=()=>{f("closeSpec")},a=({operator:o,firstIndex:t,secondIndex:e,specIndex:n})=>{H({operator:o,firstIndex:t,secondIndex:e,spec:n}),d()};return(o,t)=>(i(),_("div",Vt,[s("div",Mt,[s("div",zt,[s("h1",Gt,h(c(l)[0].name),1),s("span",{class:"SpecFoods__title__close",onClick:d},"x")]),s("div",Kt,[Jt,(i(!0),_(x,null,A(c(l),(e,n)=>(i(),_("div",{class:tt(["SpecFoods__content__options",{"SpecFoods__content__options--isChosed":c(S)===n}]),onClick:C=>c(v)(n,e)},h(e.specs[0].value),11,Pt))),256))]),s("div",Qt,[s("div",Ut,"\uFFE5"+h(c(I)),1),s("button",{class:"SpecFoods__addCart__pushForm",onClick:t[0]||(t[0]=e=>a({operator:"+",firstIndex:c(y),secondIndex:c(u),specIndex:c(S)}))},"\u6DFB\u52A0\u81F3\u8D2D\u7269\u8F66")])])]))}};var Yt=J(Xt,[["__scopeId","data-v-3aca8b1e"]]);const st=p=>(P("data-v-6a127824"),p=p(),Q(),p),Zt=["onClick"],ts={class:"right__item__title1"},ss={class:"right__item__content"},es={class:"right__content__img"},os=["src"],cs={class:"right__content__intro"},ns={class:"right__content__title"},rs={class:"right__content__detail"},as={class:"right__content_price"},is=["onClick"],_s={key:1,class:"right__content__controlNum"},ls=["onClick","secondIndex","firstIndex"],ds=st(()=>s("svg",{class:"icon","aria-hidden":"true"},[s("use",{"xlink:href":"#icon-Subtract"})],-1)),us=[ds],hs={class:"right__controlNum__showNum"},ps=["onClick","secondIndex","firstIndex"],vs=st(()=>s("svg",{class:"icon","aria-hidden":"true"},[s("use",{"xlink:href":"#icon-add"})],-1)),fs=[vs],ms={setup(p){const f=V();f.storageShop=T("shopCart");const r=()=>{const d=$(null),a=$(null);let o=$([]),t=$([]),e=$(0);const n=()=>({clickLeftScrollRight:F=>{e.value=F,a.value.scrollTop=t.value[F-1]*16}}),C=()=>{const O=()=>{const j=ut(f.storeInfoData),N=ht(j);let q=[],R=[],M=0;for(let D=0;D<N.length;D++){let z=3;z+=N[D].foods.length*10,M+=z,q.push(z),R.push(M)}o.value=q,t.value=R},F=()=>{const j=a.value.scrollTop;let N;j===0&&(N=0),N=t.value.findIndex((M,D)=>j>=t.value[D]*16&&j<t.value[D+1]*16),N>=0?e.value=N+1:e.value=0;const q=d.value.scrollTop,R=e.value*5*16;R-q>240?d.value.scrollTop+=80:R-q<0&&(d.value.scrollTop-=80)};return{bindScrollEvent:ot.debounce(F),getRightHightArr:O}},{clickLeftScrollRight:w}=n(),{bindScrollEvent:L,getRightHightArr:B}=C();return{clickLeftScrollRight:w,bindScrollEvent:L,getRightHightArr:B,leftWrapper:d,rightWrapper:a,rightHightArr:o,rightHightSumArr:t,choosedIndex:e}},{clickLeftScrollRight:k,bindScrollEvent:y,getRightHightArr:u,leftWrapper:l,rightWrapper:b,choosedIndex:g}=r();it(()=>{u()}),_t(()=>f.storeInfoData,()=>{u()});const I=()=>{let d=$(!1);return{changeShowSpec:(t,e)=>{d.value=!d.value;const n=f.storeInfoData[e];n.restaurant_id,n.id;const w=n.foods[t];w.item_id,w.specfoods[0].food_id,f.specObj={classId:e,foodId:t}},closeShowSpec:t=>{t.target.className==="mask specFoods"&&(d.value=!d.value)},showSpec:d}},{changeShowSpec:m,closeShowSpec:S,showSpec:v}=I();return(d,a)=>(i(),_(x,null,[s("div",{class:"ScrollComponent",onClick:a[2]||(a[2]=(...o)=>c(S)&&c(S)(...o))},[(i(),Z(lt,{to:"body"},[c(v)?(i(),Z(Yt,{key:0,class:"specFoods",onCloseSpec:a[0]||(a[0]=o=>v.value=!c(v))})):W("",!0)])),s("div",{class:"left",ref_key:"leftWrapper",ref:l},[(i(!0),_(x,null,A(c(f).storeInfoData,(o,t)=>(i(),_("div",{class:tt(["left__item",{"left__item--isChosed":c(g)===t}]),key:t,onClick:e=>c(k)(t)},h(o.name),11,Zt))),128))],512),s("div",{class:"right",ref_key:"rightWrapper",ref:b,onScroll:a[1]||(a[1]=(...o)=>c(y)&&c(y)(...o))},[(i(!0),_(x,null,A(c(f).storeInfoData,(o,t)=>(i(),_("div",{class:"right__item",key:t},[s("div",ts,h(o.name),1),(i(!0),_(x,null,A(o.foods,(e,n)=>{var C,w,L,B,O;return i(),_("div",{class:"right__item__contents",key:n},[s("div",ss,[s("div",es,[s("img",{src:`https://elm.cangdu.org/img/${e.image_path}`,alt:""},null,8,os)]),s("div",cs,[s("h1",ns,h(e.name),1),s("p",rs,"\u6708\u552E"+h(e.month_sales)+"\u4EFD\xA0\u597D\u8BC4\u7387"+h(e.satisfy_rate)+"%",1),s("p",as,"\uFFE5"+h(e.specfoods[0].price),1),e.specfoods.length>1?(i(),_("button",{key:0,class:"right__content__spec",onClick:F=>c(m)(n,t)},"\u9009\u89C4\u683C",8,is)):(i(),_("div",_s,[s("div",{class:"right__controlNum__subtract",onClick:F=>c(H)({secondIndex:n,firstIndex:t,operator:"-",spec:null}),secondIndex:n,firstIndex:t},us,8,ls),s("div",hs,h(((O=(B=(L=(w=(C=c(f).storageShop)==null?void 0:C[e.restaurant_id])==null?void 0:w[e.category_id])==null?void 0:L[e.item_id])==null?void 0:B[e.specfoods[0].sku_id])==null?void 0:O.quantity)||0),1),s("div",{class:"right__controlNum__add",onClick:F=>c(H)({secondIndex:n,firstIndex:t,operator:"+",spec:null}),secondIndex:n,firstIndex:t},fs,8,ps)]))])])])}),128))]))),128))],544)]),dt(Wt)],64))}};var Is=J(ms,[["__scopeId","data-v-6a127824"]]);export{Is as default};
